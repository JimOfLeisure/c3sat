<!DOCTYPE HTML>
<html>
<head>
  <title>Civ3 Show-and-Tell JSON/d3/SVG Map</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
<script>

mapstyle = {
    'baseTerrain': {
        // desert
        0x00: 'cornsilk',
        // plains
        0x01: 'sandybrown',
        // grassland
        0x02: 'green',
        // tundra
        0x03: 'white',
        // coast
        0x0b: 'blue',
        // sea
        0x0c: 'mediumblue',
        // ocean
        0x0d: 'darkblue'
    }
}
// load map json file
d3.json("civmap.json", function(error, data){
    if (error) return console.warn(error);
    else
    // Just making sure I have the data
    console.log(data.tile.length); 
    console.log(data.width); 
    console.log(data.height); 

    // Add svg element and assign to var
    var svg = d3.select('body').append('svg')
       .attr('style', 'background: gray')
       .attr('width', data.width * 64 + 64)
       .attr('height', data.height * 32 + 32);

    var tiles = svg.selectAll('polygon')
        .data(data.tile);

    // Adds tiles to the DOM
    tiles.enter().append('polygon')
       .attr('points', '0,32 64,0 128,32 64,64');

    // Set x transforms for tiles
    tiles.attr('transform', function(d, i) {
       // tile-width * map width, aslo add half-tile offset to the right for odd rows
       x = 128 * (i % (data.width / 2)) + 64 * ( Math.floor(i / (data.width /2)) % 2);
       y = 32 * Math.floor(i / (data.width / 2));
       return 'translate(' + x.toString() + ',' + y.toString() + ')'
    });

    // Assign fill color based on terrain
    tiles.attr('style', function(d, i) {
       myFill = mapstyle.baseTerrain[d.info.terrain & 0x0F] 
       if (myFill)
         return 'fill: ' + myFill
       else {
         console.warn('Unstyled tile terrain ' + d.info.terrain.toString())
         return 'fill: red'
       }
    });
});
</script>
</head>
<body>
  <h1>Civ3 Show-and-Tell JSON/d3/SVG Map</h1>
</body>
</html>
